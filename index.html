<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src='https://api.mapbox.com/mapbox-gl-js/v3.12.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v3.12.0/mapbox-gl.css' rel='stylesheet' />
    <link rel="stylesheet" href="/style.css">
    <title>IL House of Reps Networth Map</title>
</head>

<body>

    <div class="container">

        <h1 class="title">Not Like Us?</h1>

        <h2>How Does Congressional Networth Compare to Their Constituent's Income?</h2>

        <section class="main">
            <div class="map-overlay-right" id="properties"></div>
            <div class="map-legend-container">
                <div id='map'></div>
                <div class="map-overlay" id="legend"></div>
                <button id="toggle-legend-btn">Show Legend</button>
            </div>

        </section>

        <section class="methodology">

            <h3>Methodology</h3>

            <p>

            <p>Congressional net worth estimates are based on 2023 financial disclosure reports downloaded from the <a
                    href="https://disclosures-clerk.house.gov/FinancialDisclosure">House of Representatives</a>. Asset
                and liability ranges were reviewed and aggregated to calculate an average net worth for each
                representative.
            </p>

            <p>I followed the <a href="https://www.opensecrets.org/personal-finances/methodology">Open Secrets</a>
                methodology for figuring net worth of congressional representatives.

            <blockquote>Net worth was calculated by summing the filer's assets and then subtracting any listed
                liabilities.
                Filers report the amount of each of their assets, transactions and liabilities as falling within one of
                several ranges. The minimum possible values for each asset were added together as were the maximum
                possible
                values. Likewise, minimum and maximum liability amounts were summed. The maximum debt figure was then
                subtracted from the minimum asset figure and the minimum debt figure was subtracted from the maximum
                asset
                figure. The resulting range represents the extremes of how much a filer could be worth, and his or her
                actual net worth should fall somewhere within that range.</blockquote>
            </p>

            <p>
                An index score was calculated in an attempt to normalize and compare the net worth of congressional
                representatives relative to their constiuency. It is challenging to find data on the average or median
                networth of folks living in a congressional district. As a proxy I used median annual income of a
                congressional district. District-level median household income data comes from the U.S. Census Bureau.

                Thus the calculation for the index is:

            <blockquote><em>(Congressional Net Worth − Constituent Median Income) ÷ Constituent Median Income</em>
            </blockquote>

            </p>

            <p>
                While it would be best to use the net worth of the constituency, such data is difficult to find. This
                was conducted as an exploratory exercise to see if any large discrepancies exist that would prompt
                future
                investigation.
            </p>

            <h3>Why this Matters</h3>

            <p>The main question we are seeking to answer is: <b>Can a representative that is 5 times, 10 times, or over
                    100 times more wealthy than their constituency understand the needs of their district?</b>

            <p>Which yields additional questions such as:</p>

            <ul>
                <li>How does their wealth change their understanding of and relationship to work?</li>
                <li>To time and family?</li>
                <li>To risk, debt, and healthcare?</li>
                <li>Once elected, does their substantial wealth work to keep them in power?</li>
                <li>How much has their wealth changed since being elected?</li>
            </ul>
            </p>

            <p>The intent of this project is not to shame individuals. It's purpose is to provoke thought and encourage
                deeper questions about how wealth, representation, and policy intersect. Hopefully it inspires you to
                consider such questions the next time you head to the ballot box.</p>
        </section>

    </div>
    <script>

        // Shortened display names

        displayNames = {
            'il_district': 'District',
            'IL_Congressional_NetWorth$.Congressperson': 'Congressperson',
            'IL_Congressional_NetWorth$.Average_Net_Worth': 'Avg. Net Worth',
            'IL_Congressional_NetWorth$.B19013_001E___Median_Household_': 'Median Household Income',
            'wealth_index': 'Wealth Disparity Score'
        };

        const MB_token = 'pk.eyJ1IjoicGV0cnVzbWVsbHkiLCJhIjoiY21jNmk5OWxsMG1nYTJucHgyYjA2cjN5ZyJ9.m2O9DLKhe3A1GNNVTexNig';

        mapboxgl.accessToken = MB_token;
        const map = new mapboxgl.Map({
            container: 'map', // container ID
            style: 'mapbox://styles/mapbox/satellite-v9', // style URL
            center: [-89, 40.6], // starting position [lng, lat]
            zoom: 5, // starting zoom
        });

        const card = document.getElementById('properties');

        const intro = `
        <p>Click on a congressional district to see that representative’s estimated net worth, the median annual income of their district, and a wealth disparity score for comparison.</p>

        <p>The <b>wealth disparity index</b> compares a representative’s net worth to the income of the people they represent. It answers the question: how much more (or less) wealth does a congressperson have compared to the typical household in their district?</p>

        <p>The score is calculated by subtracting the median household income from the representative’s net worth, then dividing the result by the median income. In other words:  
        <b><em>(Net Worth − Median Income) ÷ Median Income</em></b>.</p>

        <p>A score of 0 means the representative’s net worth is equal to the district’s median income. A score of 1 means they have twice as much. A score of 2 means three times as much, and so on. Negative scores indicate the representative has <em>less</em> wealth than the typical household in their district.</p>

        <p>For example, a score of <b>200</b> means the representative's net worth is <b>201 times greater</b> than the district’s median income—a disparity of 20,000%.</p>

        <p>Additional methodology details can be found at the bottom of the page as well as links to sources.</p>
        `;

        card.innerHTML = intro;

        const showCard = (feature) => {
            const listItems = Object.entries(feature.properties).filter(([key]) => displayNames[key]).map(([key, value]) => {
                let formattedValue = value;
                if (typeof value === 'number' && key !== 'il_district' && key !== 'wealth_index') {
                    formattedValue = `$${value.toLocaleString()}`;
                }
                return `<li><b>${displayNames[key]}</b>: ${formattedValue}</li>`
            })
                .join('');

            card.innerHTML = `
            <div class="map-overlay-inner">
                <span id='district-heading'>${feature.properties.il_district} – ${feature.properties['IL_Congressional_NetWorth$.Congressperson']}</span>
                <hr>
                <ul>${listItems}</ul>
                <br><button id="show-intro-btn">Show Intro</button>
                </div>`;

            card.style.display = 'block';

            // Click event listener for the button to toggle back to introduction/instructions
            document.getElementById('show-intro-btn').addEventListener('click', () => {
                card.innerHTML = intro;
            });
        };

        map.on('load', () => {
            // Adding our GeoJSON data to the map
            map.addSource('congress-networth', {
                type: 'geojson',
                data: 'congress_nw.geojson'
            });


            const layers = [
                'Below District Median',
                'Slightly Above Median',
                'Wealthy',
                'Very Wealthy',
                'Extremely Wealthy',
            ];

            const colors = [
                '#D2F2D4',
                '#7BE382',
                '#26CC00',
                '#22B600',
                '#009C1A'
            ];

            const legend = document.getElementById('legend');

            layers.forEach((layer, i) => {
                const color = colors[i];
                const item = document.createElement('div');
                const key = document.createElement('span');
                item.className = 'legend-item';
                key.className = 'legend-key';
                key.style.backgroundColor = color;

                const value = document.createElement('span');
                value.innerHTML = `${layer}`;
                item.appendChild(key);
                item.appendChild(value);
                legend.appendChild(item);
            });

            // Adding congressional networth data to the map.
            // This includes the fill color logic for the choropleth map
            // As well as upon hovering, a district turns blue
            map.addLayer({
                'id': 'networth-layer',
                'type': 'fill',
                'source': 'congress-networth',
                'paint': {
                    'fill-color': [
                        'case',
                        ['boolean', ['feature-state', 'hover'], false],
                        '#0066ff',
                        [
                            'step',
                            ['get', 'wealth_index'],
                            '#f1eef6', //default color or < first step
                            .00001, '#D2F2D4',
                            10, '#7BE382',
                            50, '#26CC00',
                            100, '#22B600',
                            216, '#009C1A'
                        ]
                    ],
                    'fill-opacity': 0.85,
                    'fill-outline-color': '#ffffff'
                }
            });

            let hoverId = null;

            // 'e' is the event object in MapBox GL JS
            // e.features is an array of GeoJSON features from the layer under the mouse at the moment
            // e.features has a length b/c if 1 or more features are under cursor, length = 1 or more, if you're on the background or outside the layer, its 0
            // we're saying when the mouse moves on the networth layer, if the hover is over a polygon from net worth layer, do the hover effect
            map.on('mousemove', 'networth-layer', (e) => {
                if (e.features.length > 0) {
                    if (hoverId !== null) {
                        map.setFeatureState(
                            { source: 'congress-networth', id: hoverId },
                            { hover: false }
                        );
                    }

                    // e.features[0] is the first feature under the mouse
                    // so here we're going into the hover feature and grabbing its id
                    // that zero index is just a reference to the first feature under the mouse
                    hoverId = e.features[0].id;

                    map.setFeatureState(
                        { source: 'congress-networth', id: hoverId },
                        { hover: true }
                    );
                }
            });

            map.on('mouseleave', 'networth-layer', () => {
                if (hoverId !== null) {
                    map.setFeatureState(
                        { source: 'congress-networth', id: hoverId },
                        { hover: false }
                    );
                }
                hoverId = null;
            })

            let selectedFeature = null;
            map.on('click', 'networth-layer', (e) => {
                const feature = e.features[0];
                if (selectedFeature) {
                    map.setFeatureState(selectedFeature, { selected: false });
                }

                selectedFeature = feature;
                map.setFeatureState(feature, { selected: true });
                showCard(feature);
            }
            );
        });


        //Toggle legend button for small screens/mobile devices:

        const toggleBtn = document.getElementById('toggle-legend-btn');
        const legend = document.getElementById('legend');

        toggleBtn.addEventListener('click', () => {
            legend.classList.toggle('show');
            toggleBtn.textContent = legend.classList.contains('show') ? 'Hide Legend' : 'Show Legend';
        });

    </script>

</body>

</html>